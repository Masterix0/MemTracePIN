# Trace Analysis Tool

This tool analyzes memory access trace files generated by our custom Intel PIN tool.
It assumes 4KB pages (but can be easily modified to support other page sizes).
It divides the program execution into several smaller intervals and simulates page placement according to three different scoring types: time of first access, total accesses, and page table scan (PTS) scoring.
The number of pages allocated to DRAM in each interval is a percentage of the number of pages accessed in that interval, being determined by the DRAM percentage parameter.
The tool then calculates the DRAM hit ratio (percentage of memory accesses that hit pages in DRAM) for each scoring type in each interval.
Finally, the tool outputs the DRAM hit ratios for each interval to a CSV file, and it also calculates the overall DRAM hit ratios for each scoring type.
Additionally, it computes the variance of DRAM hit ratios across all intervals, treating them as the entire population of the program execution.

## Table of Contents

- [Requirements](#requirements)
- [Compilation](#compilation)
- [Usage](#usage)
- [Running Multiple Analyses](#running-multiple-analyses)
- [Arguments](#arguments)
- [Example](#example)
- [Variance Calculation](#variance-calculation)
- [Cleaning Up](#cleaning-up)

## Requirements

- Java Development Kit (JDK) 8 or higher

## Compilation

To compile the project, use the provided `makefile`:

```sh
make
```

## Usage

To run the trace analysis tool, use the following command:

```sh
java -cp bin TraceAnalyzer <workload_name> <real_time_interval_ms> <real_time_run_ms> <tracing_run_ms> <trace_directory> <dram_percentage> <sub_interval_duration_ms>
```

## Arguments

- **`workload_name`**: Name of the workload being analyzed. This will be used to name the output CSV file. IMPORTANT: Do not include spaces or hyphens in the name. (e.g., `this-name-will-break-the-tool`, `this name will also break it` and `this_name_is_fine`).
- **`real_time_interval_ms`**: Size of the real-time interval window in milliseconds.
- **`real_time_run_ms`**: Total runtime of the real-time benchmark in milliseconds.
- **`tracing_run_ms`**: Total runtime of the tracing run in milliseconds.
- **`trace_directory`**: Directory where the trace files are located.
- **`dram_percentage`**: Percentage of total memory pages that are assumed to fit in DRAM in each interval.
- **`sub_interval_duration_ms`**: Duration of each sub-interval for page table scan (PTS) scoring in milliseconds.

## Example

```sh
java -cp bin TraceAnalyzer my_workload 3 12 25000 ../MyPinTool/sorted/ 0.3 1
```

This command analyzes the trace with:
- Workload name: `my_workload`
- An interval window of 3 milliseconds
- Real runtime of 12 milliseconds
- Trace runtime of 25000 milliseconds
- Trace files located in `../MyPinTool/sorted/`
- DRAM percentage of 30%
- Sub-interval duration of 1 millisecond

The output CSV file will be named based on the workload name and parameters, following the format: `my_workload-3-1.00-0.30.csv`.

**Note:** The tool assumes that the trace files contain memory accesses sorted by time of access. If the trace files are not sorted, the tool will not work correctly.

**Note2:** You may have to increase the Java heap size using the `-Xmx` option if you are analyzing large traces.

## Running Multiple Analyses

You can run multiple trace analyses consecutively using a Bash script that reads commands from a file and executes them sequentially. This is particularly useful when you want to run the trace analyzer with different parameters and log all terminal output to a file.

### Steps:

1. **Create a file with the list of commands**  
   Populate the file named `tracer_commands_list.txt`, where each line should contain a command to be executed. For example:
   ```sh
   time java -Xmx58g -cp bin TraceAnalyzer mega_simulation 100 2923 1269960000 ~/a/sample/path/to/workload/ 0.2 20
   time java -Xmx58g -cp bin TraceAnalyzer wham_a_lam_LLM 100 3200 1300000000 ~/a/sample/path/to/workload/ 0.3 15
   ```

These commands will run the trace analyzer with different parameters and trace files, while recording the time taken to execute each command and increasing the Java heap size to 58GB.

2. **Use the provided Bash script to run the commands**  
   The script `run_tracer_commands.sh` will execute each command from the file and log the terminal output to `tracer_output.log`. To use the script:
   ```sh
   ./run_tracer_commands.sh
   ```

   The script will read each line from `tracer_commands_list.txt`, execute the command, and append the output to `tracer_output.log`.

## Variance Calculation

At the end of the analysis, the tool also calculates the overall DRAM hit ratios and the variance across all intervals for each classification type (Actual, Estimated, and PTS).
Since the intervals cover the entire program execution, they are treated as the entire population, and the variance is computed accordingly.

## Cleaning Up

To clean the build artifacts, use:

```sh
make clean
```

**Note:** This will not remove the tracer commands list file, but will delete everything else (including the csv files and output log file).